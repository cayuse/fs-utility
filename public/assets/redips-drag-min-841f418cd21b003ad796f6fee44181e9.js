var REDIPS=REDIPS||{};REDIPS.drag=function(){var e,o,t,r,n,d,l,i,a,s,c,f,p,u,g,m,h,v,b,E,w,I,y,D,R,S,P,N,T,x,B,C,k,j,O,L,A,M,W,Y,_,H,z,V,X,q,G,U,K,J=null,$=0,F=0,Q=null,Z=null,eo=[],oo=null,to=0,ro=0,no=0,lo=0,io=0,ao=0,so=[],co=[],fo=[],po=null,uo=null,go=0,mo=0,ho=0,vo=0,bo=!1,Eo=!1,wo=!1,Io=[],yo=null,Do=null,Ro=null,So=null,Po=null,No=null,To=null,xo=null,Bo=null,Co=!1,ko=!1,jo="cell",Oo={div:[],cname:"only",other:"deny"},Lo={action:"deny",cname:"mark",exception:[]},Ao={},Mo={keyDiv:!1,keyRow:!1,sendBack:!1,drop:!1};return t=function(){return!1},e=function(e){var o,t,r,n,d;for(so.length=0,n=void 0===e?po.getElementsByTagName("table"):document.querySelectorAll(e),o=e=0;e<n.length;e++)if(!("redips_clone"===n[e].parentNode.id||-1<n[e].className.indexOf("nolayout"))){t=n[e].parentNode,r=0;do"TD"===t.nodeName&&r++,t=t.parentNode;while(t&&t!==po);for(so[o]=n[e],so[o].redips||(so[o].redips={}),so[o].redips.container=po,so[o].redips.nestedLevel=r,so[o].redips.idx=o,Io[o]=0,r=so[o].getElementsByTagName("td"),t=0,d=!1;t<r.length;t++)if(1<r[t].rowSpan){d=!0;break}so[o].redips.rowspan=d,o++}for(e=0,n=q=1;e<so.length;e++)if(0===so[e].redips.nestedLevel){for(so[e].redips.nestedGroup=n,so[e].redips.sort=100*q,t=so[e].getElementsByTagName("table"),o=0;o<t.length;o++)-1<t[o].className.indexOf("nolayout")||(t[o].redips.nestedGroup=n,t[o].redips.sort=100*q+t[o].redips.nestedLevel);n++,q++}},r=function(o){var t,r,n=o||window.event;if(!0===this.redips.animated)return!0;if(n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),Eo=n.shiftKey,o=n.which?n.which:n.button,P(n)||!n.touches&&1!==o)return!0;if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection&&"Text"===document.selection.type)try{document.selection.empty()}catch(a){}return n.touches?(o=go=n.touches[0].clientX,r=mo=n.touches[0].clientY):(o=go=n.clientX,r=mo=n.clientY),ho=o,vo=r,bo=!1,REDIPS.drag.objOld=ko=Co||this,REDIPS.drag.obj=Co=this,wo=-1<Co.className.indexOf("clone")?!0:!1,REDIPS.drag.tableSort&&d(Co),po!==Co.redips.container&&(po=Co.redips.container,e()),-1===Co.className.indexOf("row")?REDIPS.drag.mode=jo="cell":(REDIPS.drag.mode=jo="row",REDIPS.drag.obj=Co=Y(Co)),E(),!wo&&"cell"===jo&&(Co.style.zIndex=999),yo=So=To=null,g(),Ro=Do=yo,No=Po=So,Bo=xo=To,REDIPS.drag.td.source=Ao.source=T("TD",Co),REDIPS.drag.td.current=Ao.current=Ao.source,REDIPS.drag.td.previous=Ao.previous=Ao.source,"cell"===jo?REDIPS.drag.event.clicked(Ao.current):REDIPS.drag.event.rowClicked(Ao.current),null!==yo&&null!==So&&null!==To||(g(),Ro=Do=yo,No=Po=So,Bo=xo=To,null!==yo&&null!==So&&null!==To)?(G=U=!1,REDIPS.event.add(document,"mousemove",i),REDIPS.event.add(document,"touchmove",i),REDIPS.event.add(document,"mouseup",l),REDIPS.event.add(document,"touchend",l),Co.setCapture&&Co.setCapture(),null!==yo&&null!==So&&null!==To&&(X=v(yo,So,To)),t=N(so[Ro],"position"),"fixed"!==t&&(t=N(so[Ro].parentNode,"position")),t=b(Co,t),J=[r-t[0],t[1]-o,t[2]-r,o-t[3]],po.onselectstart=function(e){return n=e||window.event,P(n)?void 0:(n.shiftKey&&document.selection.clear(),!1)},!1):!0},n=function(){REDIPS.drag.event.dblClicked()},d=function(e){var o;for(o=T("TABLE",e).redips.nestedGroup,e=0;e<so.length;e++)so[e].redips.nestedGroup===o&&(so[e].redips.sort=100*q+so[e].redips.nestedLevel);so.sort(function(e,o){return o.redips.sort-e.redips.sort}),q++},Y=function(e,o){var t,r,n,d,l,i;if("DIV"===e.nodeName)return d=e,e=T("TR",e),void 0===e.redips&&(e.redips={}),e.redips.div=d,e;for(r=e,void 0===r.redips&&(r.redips={}),e=T("TABLE",e),wo&&U&&(d=r.redips.div,d.className=z(d.className.replace("clone",""))),t=e.cloneNode(!0),wo&&U&&(d.className+=" clone"),n=t.rows.length-1,d="animated"===o?0===n?!0:!1:!0,l=n;l>=0;l--)if(l!==r.rowIndex){if(!0===d&&void 0===o)for(n=t.rows[l],i=0;i<n.cells.length;i++)if(-1<n.cells[i].className.indexOf("rowhandler")){d=!1;break}t.deleteRow(l)}return U||(r.redips.emptyRow=d),t.redips={},t.redips.container=e.redips.container,t.redips.sourceRow=r,H(r,t.rows[0]),R(r,t.rows[0]),document.getElementById("redips_clone").appendChild(t),r=b(r,"fixed"),t.style.position="fixed",t.style.top=r[0]+"px",t.style.left=r[3]+"px",t.style.width=r[1]-r[3]+"px",t},_=function(o,t,r){var n,d,l,i,a,s,c,f,p=!1;f=function(e){var o;void 0!==e.redips&&e.redips.emptyRow?W(e,"empty",REDIPS.drag.style.rowEmptyColor):(o=T("TABLE",e),o.deleteRow(e.rowIndex))},void 0===r?r=Co:p=!0,n=r.redips.sourceRow,d=n.rowIndex,l=T("TABLE",n),i=n.parentNode,o=so[o],t>o.rows.length-1&&(t=o.rows.length-1),a=o.rows[t],s=t,c=a.parentNode,t=r.getElementsByTagName("tr")[0],r.parentNode.removeChild(r),!1!==REDIPS.drag.event.rowDroppedBefore(l,d)&&(!p&&-1<Ao.target.className.indexOf(REDIPS.drag.trash.className)?U?REDIPS.drag.event.rowDeleted():REDIPS.drag.trash.questionRow?confirm(REDIPS.drag.trash.questionRow)?(f(n),REDIPS.drag.event.rowDeleted()):(delete ko.redips.emptyRow,REDIPS.drag.event.rowUndeleted()):(f(n),REDIPS.drag.event.rowDeleted()):(s<o.rows.length?yo===Ro?d>s?c.insertBefore(t,a):c.insertBefore(t,a.nextSibling):"after"===REDIPS.drag.rowDropMode?c.insertBefore(t,a.nextSibling):c.insertBefore(t,a):(c.appendChild(t),a=o.rows[0]),a&&a.redips&&a.redips.emptyRow?o.deleteRow(a.rowIndex):"overwrite"===REDIPS.drag.rowDropMode?f(a):"switch"===REDIPS.drag.rowDropMode&&!U&&(i.insertBefore(a,n),void 0!==n.redips&&delete n.redips.emptyRow),(p||!U)&&f(n),delete t.redips.emptyRow,p||REDIPS.drag.event.rowDropped(t,l,d)),0<t.getElementsByTagName("table").length&&e())},H=function(e,o){var t,r,n,d=[],l=[];for(d[0]=e.getElementsByTagName("input"),d[1]=e.getElementsByTagName("textarea"),d[2]=e.getElementsByTagName("select"),l[0]=o.getElementsByTagName("input"),l[1]=o.getElementsByTagName("textarea"),l[2]=o.getElementsByTagName("select"),t=0;t<d.length;t++)for(r=0;r<d[t].length;r++)switch(n=d[t][r].type){case"text":case"textarea":case"password":l[t][r].value=d[t][r].value;break;case"radio":case"checkbox":l[t][r].checked=d[t][r].checked;break;case"select-one":l[t][r].selectedIndex=d[t][r].selectedIndex;break;case"select-multiple":for(n=0;n<d[t][r].options.length;n++)l[t][r].options[n].selected=d[t][r].options[n].selected}},l=function(o){var t,r,n,d=o||window.event,o=d.clientX;if(n=d.clientY,io=ao=0,Co.releaseCapture&&Co.releaseCapture(),REDIPS.event.remove(document,"mousemove",i),REDIPS.event.remove(document,"touchmove",i),REDIPS.event.remove(document,"mouseup",l),REDIPS.event.remove(document,"touchend",l),po.onselectstart=null,c(Co),Q=document.documentElement.scrollWidth,Z=document.documentElement.scrollHeight,io=ao=0,!U||"cell"!==jo||null!==yo&&null!==So&&null!==To)if(null===yo||null===So||null===To)REDIPS.drag.event.notMoved();else{if(yo<so.length?(d=so[yo],REDIPS.drag.td.target=Ao.target=d.rows[So].cells[To],h(yo,So,To,X),t=yo,r=So):null===Do||null===Po||null===xo?(d=so[Ro],REDIPS.drag.td.target=Ao.target=d.rows[No].cells[Bo],h(Ro,No,Bo,X),t=Ro,r=No):(d=so[Do],REDIPS.drag.td.target=Ao.target=d.rows[Po].cells[xo],h(Do,Po,xo,X),t=Do,r=Po),"row"===jo)if(G)if(Ro===t&&No===r){for(d=Co.getElementsByTagName("tr")[0],ko.style.backgroundColor=d.style.backgroundColor,o=0;o<d.cells.length;o++)ko.cells[o].style.backgroundColor=d.cells[o].style.backgroundColor;Co.parentNode.removeChild(Co),delete ko.redips.emptyRow,U?REDIPS.drag.event.rowNotCloned():REDIPS.drag.event.rowDroppedSource(Ao.target)}else _(t,r);else REDIPS.drag.event.rowNotMoved();else if(U||bo)if(U&&Ro===yo&&No===So&&Bo===To)Co.parentNode.removeChild(Co),co[ko.id]-=1,REDIPS.drag.event.notCloned();else if(U&&!1===REDIPS.drag.clone.drop&&(o<d.redips.offset[3]||o>d.redips.offset[1]||n<d.redips.offset[0]||n>d.redips.offset[2]))Co.parentNode.removeChild(Co),co[ko.id]-=1,REDIPS.drag.event.notCloned();else if(-1<Ao.target.className.indexOf(REDIPS.drag.trash.className))Co.parentNode.removeChild(Co),REDIPS.drag.trash.question?setTimeout(function(){confirm(REDIPS.drag.trash.question)?s():(U||(so[Ro].rows[No].cells[Bo].appendChild(Co),E()),REDIPS.drag.event.undeleted())},20):s();else if("switch"===REDIPS.drag.dropMode)if(o=REDIPS.drag.event.droppedBefore(Ao.target),!1===o)a(!1);else{for(Co.parentNode.removeChild(Co),d=Ao.target.getElementsByTagName("div"),t=d.length,o=0;t>o;o++)void 0!==d[0]&&(REDIPS.drag.objOld=ko=d[0],Ao.source.appendChild(ko),f(ko));a(),t&&REDIPS.drag.event.switched()}else"overwrite"===REDIPS.drag.dropMode?(o=REDIPS.drag.event.droppedBefore(Ao.target),!1!==o&&C(Ao.target)):o=REDIPS.drag.event.droppedBefore(Ao.target),a(o);else REDIPS.drag.event.notMoved();"cell"===jo&&0<Co.getElementsByTagName("table").length&&e(),E(),REDIPS.drag.event.finish()}else Co.parentNode.removeChild(Co),co[ko.id]-=1,REDIPS.drag.event.notCloned();Do=Po=xo=null},a=function(e){var o,t=null;if(!1!==e){if(!0===Mo.sendBack){for(e=Ao.target.getElementsByTagName("DIV"),o=0;o<e.length;o++)if(Co!==e[o]&&0===Co.id.indexOf(e[o].id)){t=e[o];break}if(t)return S(t,1),void Co.parentNode.removeChild(Co)}"shift"===REDIPS.drag.dropMode&&(V(Ao.target)||"always"===REDIPS.drag.shift.after)&&k(Ao.source,Ao.target),"top"===REDIPS.drag.multipleDrop&&Ao.target.hasChildNodes()?Ao.target.insertBefore(Co,Ao.target.firstChild):Ao.target.appendChild(Co),f(Co),REDIPS.drag.event.dropped(Ao.target),U&&(REDIPS.drag.event.clonedDropped(Ao.target),S(ko,-1))}else U&&Co.parentNode&&Co.parentNode.removeChild(Co)},f=function(e,o){!1===o?(e.onmousedown=null,e.ontouchstart=null,e.ondblclick=null):(e.onmousedown=r,e.ontouchstart=r,e.ondblclick=n)},c=function(e){e.style.top="",e.style.left="",e.style.position="",e.style.zIndex=""},s=function(){var e;if(U&&S(ko,-1),"shift"===REDIPS.drag.dropMode&&("delete"===REDIPS.drag.shift.after||"always"===REDIPS.drag.shift.after)){switch(REDIPS.drag.shift.mode){case"vertical2":e="lastInColumn";break;case"horizontal2":e="lastInRow";break;default:e="last"}k(Ao.source,x(e,Ao.source)[2])}REDIPS.drag.event.deleted(U)},i=function(e){var o,t,r,n,e=e||window.event,d=REDIPS.drag.scroll.bound;if(e.touches?(t=go=e.touches[0].clientX,r=mo=e.touches[0].clientY):(t=go=e.clientX,r=mo=e.clientY),o=Math.abs(ho-t),n=Math.abs(vo-r),G||("cell"===jo&&(wo||!0===REDIPS.drag.clone.keyDiv&&Eo)?(REDIPS.drag.objOld=ko=Co,REDIPS.drag.obj=Co=D(Co,!0),U=!0,REDIPS.drag.event.cloned()):("row"===jo&&((wo||!0===REDIPS.drag.clone.keyRow&&Eo)&&(U=!0),REDIPS.drag.objOld=ko=Co,REDIPS.drag.obj=Co=Y(Co),Co.style.zIndex=999),Co.setCapture&&Co.setCapture(),Co.style.position="fixed",E(),g(),"row"===jo&&(U?REDIPS.drag.event.rowCloned():REDIPS.drag.event.rowMoved())),m(),t>$-J[1]&&(Co.style.left=$-(J[1]+J[3])+"px"),r>F-J[2]&&(Co.style.top=F-(J[0]+J[2])+"px")),G=!0,"cell"===jo&&(o>7||n>7)&&!bo&&(bo=!0,m(),REDIPS.drag.event.moved(U)),t>J[3]&&t<$-J[1]&&(Co.style.left=t-J[3]+"px"),r>J[0]&&r<F-J[2]&&(Co.style.top=r-J[0]+"px"),t<uo[1]&&t>uo[3]&&r<uo[2]&&r>uo[0]&&0===io&&0===ao&&(fo.containTable||t<fo[3]||t>fo[1]||r<fo[0]||r>fo[2])&&(g(),p()),REDIPS.drag.scroll.enable)for(to=d-($/2>t?t-J[3]:$-t-J[1]),to>0?(to>d&&(to=d),o=w()[0],to*=$/2>t?-1:1,0>to&&0>=o||to>0&&o>=Q-$||0!==io++||(REDIPS.event.remove(window,"scroll",E),I(window))):to=0,ro=d-(F/2>r?r-J[0]:F-r-J[2]),ro>0?(ro>d&&(ro=d),o=w()[1],ro*=F/2>r?-1:1,0>ro&&0>=o||ro>0&&o>=Z-F||0!==ao++||(REDIPS.event.remove(window,"scroll",E),y(window))):ro=0,n=0;n<eo.length;n++){if(o=eo[n],o.autoscroll&&t<o.offset[1]&&t>o.offset[3]&&r<o.offset[2]&&r>o.offset[0]){no=d-(o.midstX>t?t-J[3]-o.offset[3]:o.offset[1]-t-J[1]),no>0?(no>d&&(no=d),no*=t<o.midstX?-1:1,0===io++&&(REDIPS.event.remove(o.div,"scroll",E),I(o.div))):no=0,lo=d-(o.midstY>r?r-J[0]-o.offset[0]:o.offset[2]-r-J[2]),lo>0?(lo>d&&(lo=d),lo*=r<o.midstY?-1:1,0===ao++&&(REDIPS.event.remove(o.div,"scroll",E),y(o.div))):lo=0;break}no=lo=0}e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},p=function(){yo<so.length&&(yo!==Do||So!==Po||To!==xo)&&(null!==Do&&null!==Po&&null!==xo&&(h(Do,Po,xo,X),REDIPS.drag.td.previous=Ao.previous=so[Do].rows[Po].cells[xo],REDIPS.drag.td.current=Ao.current=so[yo].rows[So].cells[To],"switching"===REDIPS.drag.dropMode&&"cell"===jo&&(B(Ao.current,Ao.previous),E(),g()),"cell"===jo?REDIPS.drag.event.changed(Ao.current):"row"===jo&&(yo!==Do||So!==Po)&&REDIPS.drag.event.rowChanged(Ao.current)),m())},u=function(){"number"==typeof window.innerWidth?($=window.innerWidth,F=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?($=document.documentElement.clientWidth,F=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&($=document.body.clientWidth,F=document.body.clientHeight),Q=document.documentElement.scrollWidth,Z=document.documentElement.scrollHeight,E()},g=function(){var e,o,t,r,n,d;for(t=[],e=function(){null!==Do&&null!==Po&&null!==xo&&(yo=Do,So=Po,To=xo)},o=go,d=mo,yo=0;yo<so.length;yo++)if(!1!==so[yo].redips.enabled&&(t[0]=so[yo].redips.offset[0],t[1]=so[yo].redips.offset[1],t[2]=so[yo].redips.offset[2],t[3]=so[yo].redips.offset[3],void 0!==so[yo].sca&&(t[0]=t[0]>so[yo].sca.offset[0]?t[0]:so[yo].sca.offset[0],t[1]=t[1]<so[yo].sca.offset[1]?t[1]:so[yo].sca.offset[1],t[2]=t[2]<so[yo].sca.offset[2]?t[2]:so[yo].sca.offset[2],t[3]=t[3]>so[yo].sca.offset[3]?t[3]:so[yo].sca.offset[3]),t[3]<o&&o<t[1]&&t[0]<d&&d<t[2])){for(t=so[yo].redips.row_offset,So=0;So<t.length-1;So++)if(void 0!==t[So]){if(fo[0]=t[So][0],void 0!==t[So+1])fo[2]=t[So+1][0];else for(r=So+2;r<t.length;r++)if(void 0!==t[r]){fo[2]=t[r][0];break}if(d<=fo[2])break}r=So,So===t.length-1&&(fo[0]=t[So][0],fo[2]=so[yo].redips.offset[2]);do for(To=n=so[yo].rows[So].cells.length-1;To>=0&&(fo[3]=t[So][3]+so[yo].rows[So].cells[To].offsetLeft,fo[1]=fo[3]+so[yo].rows[So].cells[To].offsetWidth,!(fo[3]<=o&&o<=fo[1]));To--);while(so[yo].redips.rowspan&&-1===To&&0<So--);if(0>So||0>To?e():So!==r&&(fo[0]=t[So][0],fo[2]=fo[0]+so[yo].rows[So].cells[To].offsetHeight,(d<fo[0]||d>fo[2])&&e()),o=so[yo].rows[So].cells[To],fo.containTable=0<o.childNodes.length&&0<o.getElementsByTagName("table").length?!0:!1,-1===o.className.indexOf(REDIPS.drag.trash.className))if(d=-1<o.className.indexOf(REDIPS.drag.only.cname)?!0:!1,!0===d){if(-1===o.className.indexOf(Oo.div[Co.id])){e();break}}else{if(void 0!==Oo.div[Co.id]&&"deny"===Oo.other){e();break}if(d=-1<o.className.indexOf(REDIPS.drag.mark.cname)?!0:!1,(!0===d&&"deny"===REDIPS.drag.mark.action||!1===d&&"allow"===REDIPS.drag.mark.action)&&-1===o.className.indexOf(Lo.exception[Co.id])){e();break}}if(d=-1<o.className.indexOf("single")?!0:!1,"cell"===jo){if(("single"===REDIPS.drag.dropMode||d)&&0<o.childNodes.length){if(1===o.childNodes.length&&3===o.firstChild.nodeType)break;for(d=!0,r=o.childNodes.length-1;r>=0;r--)if(o.childNodes[r].className&&-1<o.childNodes[r].className.indexOf("drag")){d=!1;break}if(!d&&null!==Do&&null!==Po&&null!==xo&&(Ro!==yo||No!==So||Bo!==To)){e();break}}if(-1<o.className.indexOf("rowhandler")){e();break}if(o.parentNode.redips&&o.parentNode.redips.emptyRow){e();break}}break}},m=function(){yo<so.length&&null!==yo&&null!==So&&null!==To&&(X=v(yo,So,To),h(yo,So,To),Do=yo,Po=So,xo=To)},h=function(e,o,t,r){if("cell"===jo&&bo)t=so[e].rows[o].cells[t].style,t.backgroundColor=void 0===r?REDIPS.drag.hover.colorTd:r.color[0].toString(),void 0!==REDIPS.drag.hover.borderTd&&(void 0===r?t.border=REDIPS.drag.hover.borderTd:(t.borderTopWidth=r.top[0][0],t.borderTopStyle=r.top[0][1],t.borderTopColor=r.top[0][2],t.borderRightWidth=r.right[0][0],t.borderRightStyle=r.right[0][1],t.borderRightColor=r.right[0][2],t.borderBottomWidth=r.bottom[0][0],t.borderBottomStyle=r.bottom[0][1],t.borderBottomColor=r.bottom[0][2],t.borderLeftWidth=r.left[0][0],t.borderLeftStyle=r.left[0][1],t.borderLeftColor=r.left[0][2]));else if("row"===jo)for(e=so[e].rows[o],o=0;o<e.cells.length;o++)t=e.cells[o].style,t.backgroundColor=void 0===r?REDIPS.drag.hover.colorTr:r.color[o].toString(),void 0!==REDIPS.drag.hover.borderTr&&(void 0===r?yo===Ro?No>So?t.borderTop=REDIPS.drag.hover.borderTr:t.borderBottom=REDIPS.drag.hover.borderTr:"before"===REDIPS.drag.rowDropMode?t.borderTop=REDIPS.drag.hover.borderTr:t.borderBottom=REDIPS.drag.hover.borderTr:(t.borderTopWidth=r.top[o][0],t.borderTopStyle=r.top[o][1],t.borderTopColor=r.top[o][2],t.borderBottomWidth=r.bottom[o][0],t.borderBottomStyle=r.bottom[o][1],t.borderBottomColor=r.bottom[o][2]))},v=function(e,o,t){var r={color:[],top:[],right:[],bottom:[],left:[]},n=function(e,o){var t="border"+o+"Style",r="border"+o+"Color";return[N(e,"border"+o+"Width"),N(e,t),N(e,r)]};if("cell"===jo)t=so[e].rows[o].cells[t],r.color[0]=t.style.backgroundColor,void 0!==REDIPS.drag.hover.borderTd&&(r.top[0]=n(t,"Top"),r.right[0]=n(t,"Right"),r.bottom[0]=n(t,"Bottom"),r.left[0]=n(t,"Left"));else for(e=so[e].rows[o],o=0;o<e.cells.length;o++)t=e.cells[o],r.color[o]=t.style.backgroundColor,void 0!==REDIPS.drag.hover.borderTr&&(r.top[o]=n(t,"Top"),r.bottom[o]=n(t,"Bottom"));return r},b=function(e,o,t){var r=0,n=0,d=e;if("fixed"!==o&&(r=0-K[0],n=0-K[1]),void 0===t||!0===t){do r+=e.offsetLeft-e.scrollLeft,n+=e.offsetTop-e.scrollTop,e=e.offsetParent;while(e&&"BODY"!==e.nodeName)}else do r+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;while(e&&"BODY"!==e.nodeName);return[n,r+d.offsetWidth,n+d.offsetHeight,r]},E=function(){var e,o,t,r;for(K=w(),e=0;e<so.length;e++){for(t=[],r=N(so[e],"position"),"fixed"!==r&&(r=N(so[e].parentNode,"position")),o=so[e].rows.length-1;o>=0;o--)"none"!==so[e].rows[o].style.display&&(t[o]=b(so[e].rows[o],r));so[e].redips.offset=b(so[e],r),so[e].redips.row_offset=t}for(uo=b(po),e=0;e<eo.length;e++)r=N(eo[e].div,"position"),o=b(eo[e].div,r,!1),eo[e].offset=o,eo[e].midstX=(o[1]+o[3])/2,eo[e].midstY=(o[0]+o[2])/2},w=function(){var e,o;return"number"==typeof window.pageYOffset?(e=window.pageXOffset,o=window.pageYOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(e=document.body.scrollLeft,o=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?(e=document.documentElement.scrollLeft,o=document.documentElement.scrollTop):e=o=0,[e,o]},I=function(e){var o,t;o=go,t=mo,io>0&&(E(),g(),o<uo[1]&&o>uo[3]&&t<uo[2]&&t>uo[0]&&p()),"object"==typeof e&&(oo=e),oo===window?(e=w()[0],o=Q-$,t=to):(e=oo.scrollLeft,o=oo.scrollWidth-oo.clientWidth,t=no),io>0&&(0>t&&e>0||t>0&&o>e)?(oo===window?(window.scrollBy(t,0),w(),e=parseInt(Co.style.left,10),isNaN(e)):oo.scrollLeft+=t,setTimeout(I,REDIPS.drag.scroll.speed)):(REDIPS.event.add(oo,"scroll",E),io=0,fo=[0,0,0,0])},y=function(e){var o,t;o=go,t=mo,ao>0&&(E(),g(),o<uo[1]&&o>uo[3]&&t<uo[2]&&t>uo[0]&&p()),"object"==typeof e&&(oo=e),oo===window?(e=w()[1],o=Z-F,t=ro):(e=oo.scrollTop,o=oo.scrollHeight-oo.clientHeight,t=lo),ao>0&&(0>t&&e>0||t>0&&o>e)?(oo===window?(window.scrollBy(0,t),w(),e=parseInt(Co.style.top,10),isNaN(e)):oo.scrollTop+=t,setTimeout(y,REDIPS.drag.scroll.speed)):(REDIPS.event.add(oo,"scroll",E),ao=0,fo=[0,0,0,0])},D=function(e,o){var t,r,n=e.cloneNode(!0),d=n.className;return!0===o&&(document.getElementById("redips_clone").appendChild(n),n.style.zIndex=999,n.style.position="fixed",t=b(e),r=b(n),n.style.top=t[0]-r[0]+"px",n.style.left=t[3]-r[3]+"px"),n.setCapture&&n.setCapture(),d=d.replace("clone",""),d=d.replace(/climit(\d)_(\d+)/,""),n.className=z(d),void 0===co[e.id]&&(co[e.id]=0),n.id=e.id+"c"+co[e.id],co[e.id]+=1,R(e,n),n},R=function(e,o){var t,r=[];r[0]=function(e,o){e.redips&&(o.redips={},o.redips.enabled=e.redips.enabled,o.redips.container=e.redips.container,e.redips.enabled&&f(o))},r[1]=function(e,o){e.redips&&(o.redips={},o.redips.emptyRow=e.redips.emptyRow)},t=function(t){var n,d,l;for(d=["DIV","TR"],n=e.getElementsByTagName(d[t]),d=o.getElementsByTagName(d[t]),l=0;l<d.length;l++)r[t](n[l],d[l])},"DIV"===e.nodeName?r[0](e,o):"TR"===e.nodeName&&r[1](e,o),t(0),t(1)},S=function(e,t){var r,n,d;d=e.className,r=d.match(/climit(\d)_(\d+)/),null!==r&&(n=parseInt(r[1],10),r=parseInt(r[2],10),0===r&&1===t&&(d+=" clone",2===n&&o(!0,e)),r+=t,d=d.replace(/climit\d_\d+/g,"climit"+n+"_"+r),0>=r&&(d=d.replace("clone",""),2===n?(o(!1,e),REDIPS.drag.event.clonedEnd2()):REDIPS.drag.event.clonedEnd1()),e.className=z(d))},P=function(e){var o=!1;switch(e.srcElement?(o=e.srcElement.nodeName,e=e.srcElement.className):(o=e.target.nodeName,e=e.target.className),o){case"A":case"INPUT":case"SELECT":case"OPTION":case"TEXTAREA":o=!0;break;default:o=/\bnodrag\b/i.test(e)?!0:!1}return o},o=function(e,o){var t,r,n,d,l,i,a,s=[],c=[],p=/\bdrag\b/i,u=/\bnoautoscroll\b/i;for(l=REDIPS.drag.style.opacityDisabled,!0===e||"init"===e?(d=REDIPS.drag.style.borderEnabled,i="move",a=!0):(d=REDIPS.drag.style.borderDisabled,i="auto",a=!1),void 0===o?s=po.getElementsByTagName("div"):"string"==typeof o?s=document.querySelectorAll(o):"object"!=typeof o||"DIV"===o.nodeName&&-1!==o.className.indexOf("drag")?s[0]=o:s=o.getElementsByTagName("div"),r=t=0;t<s.length;t++)if(p.test(s[t].className))"init"===e||void 0===s[t].redips?(s[t].redips={},s[t].redips.container=po):!0===e&&"number"==typeof l?(s[t].style.opacity="",s[t].style.filter=""):!1===e&&"number"==typeof l&&(s[t].style.opacity=l/100,s[t].style.filter="alpha(opacity="+l+")"),f(s[t],a),s[t].style.borderStyle=d,s[t].style.cursor=i,s[t].redips.enabled=a;else if("init"===e&&(n=N(s[t],"overflow"),"visible"!==n)){for(REDIPS.event.add(s[t],"scroll",E),n=N(s[t],"position"),c=b(s[t],n,!1),n=u.test(s[t].className)?!1:!0,eo[r]={div:s[t],offset:c,midstX:(c[1]+c[3])/2,midstY:(c[0]+c[2])/2,autoscroll:n},c=s[t].getElementsByTagName("table"),n=0;n<c.length;n++)c[n].sca=eo[r];r++}},N=function(e,o){var t;return e&&e.currentStyle?t=e.currentStyle[o]:e&&window.getComputedStyle&&(t=document.defaultView.getComputedStyle(e,null)[o]),t},T=function(e,o,t){for(o=o.parentNode,void 0===t&&(t=0);o&&o.nodeName!==e;)(o=o.parentNode)&&o.nodeName===e&&t>0&&(t--,o=o.parentNode);return o},x=function(e,o){var t,r,n=T("TABLE",o);switch(e){case"firstInColumn":t=0,r=o.cellIndex;break;case"firstInRow":t=o.parentNode.rowIndex,r=0;break;case"lastInColumn":t=n.rows.length-1,r=o.cellIndex;break;case"lastInRow":t=o.parentNode.rowIndex,r=n.rows[t].cells.length-1;break;case"last":t=n.rows.length-1,r=n.rows[t].cells.length-1;break;default:t=r=0}return[t,r,n.rows[t].cells[r]]},B=function(e,o,t){var r,n,d;if(r=function(e,o){REDIPS.drag.event.relocateBefore(e,o);var t=REDIPS.drag.getPosition(o);REDIPS.drag.moveObject({obj:e,target:t,callback:function(e){var t=REDIPS.drag.findParent("TABLE",e),r=t.redips.idx;REDIPS.drag.event.relocateAfter(e,o),Io[r]--,0===Io[r]&&(REDIPS.drag.event.relocateEnd(),REDIPS.drag.enableTable(!0,t))}})},e!==o&&"object"==typeof e&&"object"==typeof o)if(d=e.childNodes.length,"animation"===t){if(d>0)for(t=T("TABLE",o),n=t.redips.idx,REDIPS.drag.enableTable(!1,t),t=0;d>t;t++)1===e.childNodes[t].nodeType&&"DIV"===e.childNodes[t].nodeName&&(Io[n]++,r(e.childNodes[t],o))}else for(r=t=0;d>t;t++)1===e.childNodes[r].nodeType&&"DIV"===e.childNodes[r].nodeName?(n=e.childNodes[r],REDIPS.drag.event.relocateBefore(n,o),o.appendChild(n),n.redips&&!1!==n.redips.enabled&&f(n),REDIPS.drag.event.relocateAfter(n)):r++},C=function(e,o){var t,r,n=[];if("TD"===e.nodeName){if(t=e.childNodes.length,"test"===o)return t=Ao.source===e?void 0:0===e.childNodes.length||1===e.childNodes.length&&3===e.firstChild.nodeType?!0:!1;for(r=0;t>r;r++)n.push(e.childNodes[0]),e.removeChild(e.childNodes[0]);return n}},k=function(e,o){var t,r,n,d,l,i,a,s,c,f,p,u,g,m,h=!1;if(g=function(e,o){REDIPS.drag.shift.animation?B(e,o,"animation"):B(e,o)},m=function(e){"delete"===REDIPS.drag.shift.overflow?C(e):"source"===REDIPS.drag.shift.overflow?g(e,Ao.source):"object"==typeof REDIPS.drag.shift.overflow&&g(e,REDIPS.drag.shift.overflow),h=!1,REDIPS.drag.event.shiftOverflow(e)},e!==o){switch(l=REDIPS.drag.shift.mode,t=T("TABLE",e),r=T("TABLE",o),i=j(r),n=t===r?[e.redips.rowIndex,e.redips.cellIndex]:[-1,-1],d=[o.redips.rowIndex,o.redips.cellIndex],p=r.rows.length,u=O(r),l){case"vertical2":t=t===r&&e.redips.cellIndex===o.redips.cellIndex?n:[p,o.redips.cellIndex];break;case"horizontal2":t=t===r&&e.parentNode.rowIndex===o.parentNode.rowIndex?n:[o.redips.rowIndex,u];break;default:t=t===r?n:[p,u]}for("vertical1"===l||"vertical2"===l?(l=1e3*t[1]+t[0]<1e3*d[1]+d[0]?1:-1,r=p,p=0,u=1):(l=1e3*t[0]+t[1]<1e3*d[0]+d[1]?1:-1,r=u,p=1,u=0),t[0]!==n[0]&&t[1]!==n[1]&&(h=!0);t[0]!==d[0]||t[1]!==d[1];)a=i[t[0]+"-"+t[1]],t[p]+=l,0>t[p]?(t[p]=r,t[u]--):t[p]>r&&(t[p]=0,t[u]++),n=i[t[0]+"-"+t[1]],void 0!==n&&(s=n),void 0!==a&&(c=a),void 0!==n&&void 0!==c||void 0!==s&&void 0!==a?(n=-1===s.className.indexOf(REDIPS.drag.mark.cname)?0:1,a=-1===c.className.indexOf(REDIPS.drag.mark.cname)?0:1,h&&0===n&&1===a&&m(s),1===n?0===a&&(f=c):(0===n&&1===a&&(c=f),g(s,c))):h&&void 0!==s&&void 0===c&&(n=-1===s.className.indexOf(REDIPS.drag.mark.cname)?0:1,0===n&&m(s))}},j=function(e){var o,t,r,n,d,l,i,a,s,c=[],f={};for(d=e.rows,l=0;l<d.length;l++)for(i=0;i<d[l].cells.length;i++){for(o=d[l].cells[i],e=o.parentNode.rowIndex,t=o.rowSpan||1,r=o.colSpan||1,c[e]=c[e]||[],a=0;a<c[e].length+1;a++)if("undefined"==typeof c[e][a]){n=a;break}for(f[e+"-"+n]=o,void 0===o.redips&&(o.redips={}),o.redips.rowIndex=e,o.redips.cellIndex=n,a=e;e+t>a;a++)for(c[a]=c[a]||[],o=c[a],s=n;n+r>s;s++)o[s]="x"}return f},O=function(e){var o,t,r=e.rows,n=0;for("string"==typeof e&&document.getElementById(e),o=0;o<r.length;o++){for(t=e=0;t<r[o].cells.length;t++)e+=r[o].cells[t].colSpan||1;e>n&&(n=e)}return n},L=function(e,o){var t,r=(o.k1-o.k2*e)*(o.k1-o.k2*e),e=e+REDIPS.drag.animation.step*(4-3*r)*o.direction;t=o.m*e+o.b,"horizontal"===o.type?(o.obj.style.left=e+"px",o.obj.style.top=t+"px"):(o.obj.style.left=t+"px",o.obj.style.top=e+"px"),e<o.last&&0<o.direction||e>o.last&&0>o.direction?setTimeout(function(){L(e,o)},REDIPS.drag.animation.pause*r):(c(o.obj),o.obj.redips&&(o.obj.redips.animated=!1),"cell"===o.mode?(!0===o.overwrite&&C(o.targetCell),o.targetCell.appendChild(o.obj),o.obj.redips&&!1!==o.obj.redips.enabled&&f(o.obj)):_(A(o.target[0]),o.target[1],o.obj),"function"==typeof o.callback&&o.callback(o.obj))},M=function(e){var o,t,r;return o=[],o=t=r=-1,void 0===e?(o=yo<so.length?so[yo].redips.idx:null===Do||null===Po||null===xo?so[Ro].redips.idx:so[Do].redips.idx,t=so[Ro].redips.idx,o=[o,So,To,t,No,Bo]):((e="string"==typeof e?document.getElementById(e):e)&&("TD"!==e.nodeName&&(e=T("TD",e)),e&&"TD"===e.nodeName&&(o=e.cellIndex,t=e.parentNode.rowIndex,e=T("TABLE",e),r=e.redips.idx)),o=[r,t,o]),o},A=function(e){var o;for(o=0;o<so.length&&so[o].redips.idx!==e;o++);return o},z=function(e){return void 0!==e&&(e=e.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ")),e},V=function(e){var o;for(o=0;o<e.childNodes.length;o++)if(1===e.childNodes[o].nodeType)return!0;return!1},W=function(e,o,t){var r,n;if("string"==typeof e&&(e=document.getElementById(e),e=T("TABLE",e)),"TR"===e.nodeName)for(e=e.getElementsByTagName("td"),r=0;r<e.length;r++)if(e[r].style.backgroundColor=t?t:"","empty"===o)e[r].innerHTML="";else for(n=0;n<e[r].childNodes.length;n++)1===e[r].childNodes[n].nodeType&&(e[r].childNodes[n].style.opacity=o/100,e[r].childNodes[n].style.filter="alpha(opacity="+o+")");else e.style.opacity=o/100,e.style.filter="alpha(opacity="+o+")",e.style.backgroundColor=t?t:""},{obj:Co,objOld:ko,mode:jo,td:Ao,hover:{colorTd:"#E7AB83",colorTr:"#E7AB83"},scroll:{enable:!0,bound:25,speed:20},only:Oo,mark:Lo,style:{borderEnabled:"solid",borderDisabled:"dotted",opacityDisabled:"",rowEmptyColor:"white"},trash:{className:"trash",question:null,questionRow:null},saveParamName:"p",dropMode:"multiple",multipleDrop:"bottom",clone:Mo,animation:{pause:20,step:2,shift:!1},shift:{mode:"horizontal1",after:"default",overflow:"bunch"},rowDropMode:"before",tableSort:!0,init:function(r){var n;for((void 0===r||"string"!=typeof r)&&(r="drag"),po=document.getElementById(r),K=w(),document.getElementById("redips_clone")||(r=document.createElement("div"),r.id="redips_clone",r.style.width=r.style.height="1px",po.appendChild(r)),o("init"),e(),u(),REDIPS.event.add(window,"resize",u),n=po.getElementsByTagName("img"),r=0;r<n.length;r++)REDIPS.event.add(n[r],"mousemove",t),REDIPS.event.add(n[r],"touchmove",t);REDIPS.event.add(window,"scroll",E)},initTables:e,enableDrag:o,enableTable:function(e,o){var t;if("object"==typeof o&&"TABLE"===o.nodeName)o.redips.enabled=e;else for(t=0;t<so.length;t++)-1<so[t].className.indexOf(o)&&(so[t].redips.enabled=e)},cloneObject:D,saveContent:function(e,o){var t,r,n,d,l,i,a,s="",c=[],f=REDIPS.drag.saveParamName;if("string"==typeof e&&(e=document.getElementById(e)),void 0!==e&&"object"==typeof e&&"TABLE"===e.nodeName){for(t=e.rows.length,l=0;t>l;l++)for(r=e.rows[l].cells.length,i=0;r>i;i++)if(n=e.rows[l].cells[i],0<n.childNodes.length)for(a=0;a<n.childNodes.length;a++)d=n.childNodes[a],"DIV"===d.nodeName&&-1<d.className.indexOf("drag")&&(s+=f+"[]="+d.id+"_"+l+"_"+i+"&",c.push([d.id,l,i]));s="json"===o&&0<c.length?JSON.stringify(c):s.substring(0,s.length-1)}return s},relocate:B,emptyCell:C,moveObject:function(o){var t,r,n,d,l,i,a={direction:1};if(a.callback=o.callback,a.overwrite=o.overwrite,"string"==typeof o.id?a.obj=a.objOld=document.getElementById(o.id):"object"==typeof o.obj&&"DIV"===o.obj.nodeName&&(a.obj=a.objOld=o.obj),"row"===o.mode){if(a.mode="row",i=A(o.source[0]),l=o.source[1],ko=a.objOld=so[i].rows[l],ko.redips&&!0===ko.redips.emptyRow)return!1;a.obj=Y(a.objOld,"animated")}else if(a.obj&&-1<a.obj.className.indexOf("row")){if(a.mode="row",a.obj=a.objOld=ko=T("TR",a.obj),ko.redips&&!0===ko.redips.emptyRow)return!1;a.obj=Y(a.objOld,"animated")}else a.mode="cell";return"object"==typeof a.obj&&null!==a.obj?(a.obj.style.zIndex=999,a.obj.redips&&po!==a.obj.redips.container&&(po=a.obj.redips.container,e()),i=b(a.obj),n=i[1]-i[3],d=i[2]-i[0],t=i[3],r=i[0],!0===o.clone&&"cell"===a.mode&&(a.obj=D(a.obj,!0),REDIPS.drag.event.cloned(a.obj)),void 0===o.target?o.target=M():"object"==typeof o.target&&"TD"===o.target.nodeName&&(o.target=M(o.target)),a.target=o.target,i=A(o.target[0]),l=o.target[1],o=o.target[2],l>so[i].rows.length-1&&(l=so[i].rows.length-1),a.targetCell=so[i].rows[l].cells[o],"cell"===a.mode?(i=b(a.targetCell),l=i[1]-i[3],o=i[2]-i[0],n=i[3]+(l-n)/2,d=i[0]+(o-d)/2):(i=b(so[i].rows[l]),n=i[3],d=i[0]),i=n-t,o=d-r,a.obj.style.position="fixed",Math.abs(i)>Math.abs(o)?(a.type="horizontal",a.m=o/i,a.b=r-a.m*t,a.k1=(t+n)/(t-n),a.k2=2/(t-n),t>n&&(a.direction=-1),i=t,a.last=n):(a.type="vertical",a.m=i/o,a.b=t-a.m*r,a.k1=(r+d)/(r-d),a.k2=2/(r-d),r>d&&(a.direction=-1),i=r,a.last=d),a.obj.redips&&(a.obj.redips.animated=!0),L(i,a),[a.obj,a.objOld]):void 0},shiftCells:k,deleteObject:function(e){"object"==typeof e&&"DIV"===e.nodeName?e.parentNode.removeChild(e):"string"==typeof e&&(e=document.getElementById(e))&&e.parentNode.removeChild(e)},getPosition:M,rowOpacity:W,rowEmpty:function(e,o,t){e=document.getElementById(e).rows[o],void 0===t&&(t=REDIPS.drag.style.rowEmptyColor),void 0===e.redips&&(e.redips={}),e.redips.emptyRow=!0,W(e,"empty",t)},getScrollPosition:w,getStyle:N,findParent:T,findCell:x,event:{changed:function(){},clicked:function(){},cloned:function(){},clonedDropped:function(){},clonedEnd1:function(){},clonedEnd2:function(){},dblClicked:function(){},deleted:function(){},dropped:function(){},droppedBefore:function(){},finish:function(){},moved:function(){},notCloned:function(){},notMoved:function(){},shiftOverflow:function(){},relocateBefore:function(){},relocateAfter:function(){},relocateEnd:function(){},rowChanged:function(){},rowClicked:function(){},rowCloned:function(){},rowDeleted:function(){},rowDropped:function(){},rowDroppedBefore:function(){},rowDroppedSource:function(){},rowMoved:function(){},rowNotCloned:function(){},rowNotMoved:function(){},rowUndeleted:function(){},switched:function(){},undeleted:function(){}}}}(),REDIPS.event||(REDIPS.event=function(){return{add:function(e,o,t){e.addEventListener?e.addEventListener(o,t,!1):e.attachEvent?e.attachEvent("on"+o,t):e["on"+o]=t},remove:function(e,o,t){e.removeEventListener?e.removeEventListener(o,t,!1):e.detachEvent?e.detachEvent("on"+o,t):e["on"+o]=null}}}());